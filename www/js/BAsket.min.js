BAsketVer="2.0.0219.49";
(function(g,h,e){h.framework.html.SlideOutController=h.framework.html.DefaultLayoutController.inherit({_getLayoutTemplateName:function(){return"slideout"},_createNavigation:function(c){this.callBase(c);this.$slideOut=g("<div/>").appendTo(this._$hiddenBag).dxSlideOut({menuItemTemplate:g("#slideOutMenuItemTemplate")}).dxCommandContainer({id:"global-navigation"});this.slideOut=this.$slideOut.dxSlideOut("instance");var a=this.$slideOut.dxCommandContainer("instance");this._commandManager._arrangeCommandsToContainers(c,[a]);
this.$slideOut.find(".dx-slideout-item-container").append(this._$mainLayout)},_getRootElement:function(){return this.$slideOut},init:function(c){this.callBase(c);this._navigationManager=c.navigationManager;this._navigatingHandler=g.proxy(this._onNavigating,this)},activate:function(){this.callBase.apply(this,arguments);this._navigationManager.navigating.add(this._navigatingHandler)},deactivate:function(){this.callBase.apply(this,arguments);this._navigationManager.navigating.remove(this._navigatingHandler)},
_onNavigating:function(c){var a=this;this.slideOut.option("menuVisible")&&c.navigateWhen.push(this._toggleNavigation().done(function(){a._disableTransitions=!0}))},_onViewShown:function(c){this._disableTransitions=!1},_isPlaceholderEmpty:function(c){c=c.renderResult.$markup.find(".layout-toolbar").data("dxToolbar").option("items");return!g.grep(c,function(a){return("back"===a.behavior||"back"===a.id)&&!0===a.visible}).length},_onRenderComplete:function(c){var a=this;a._initNavigation(c.renderResult.$markup);
a._isPlaceholderEmpty(c)&&a._initNavigationButton(c.renderResult.$markup);var f=c.renderResult.$markup.find(".layout-content"),b=c.renderResult.$markup.find(".layout-toolbar-bottom").data("dxToolbar");b&&(a._refreshAppbarVisibility(b,f),b.optionChanged.add(function(m,n){"items"===m&&a._refreshAppbarVisibility(b,f)}))},_refreshAppbarVisibility:function(c,a){var f=!1;g.each(c.option("items"),function(b,a){if(a.visible)return f=!0,!1});a.toggleClass("has-toolbar-bottom",f);c.option("visible",f)},_initNavigationButton:function(c){var a=
this,f=c.find(".layout-toolbar"),b=f.data("dxToolbar"),m=function(b,m){m=m||f.find(".nav-button-item");m.show();m.find(".nav-button").data("dxButton").option("clickAction",g.proxy(a._toggleNavigation,a,b))};m(c);b.option("itemRenderedAction",function(b){"nav-button"===b.itemData.template&&g.proxy(m,a,c)()});b.repaint()},_initNavigation:function(c){this._isNavigationVisible=!1},_toggleNavigation:function(c){return this.slideOut.toggleMenuVisibility()}});h.framework.html.layoutControllers.push({navigationType:"slideout",
platform:"ios",controller:new h.framework.html.SlideOutController});h.framework.html.layoutControllers.push({navigationType:"slideout",platform:"android",controller:new h.framework.html.SlideOutController});h.framework.html.layoutControllers.push({navigationType:"slideout",platform:"tizen",controller:new h.framework.html.SlideOutController});h.framework.html.layoutControllers.push({navigationType:"slideout",platform:"win8",phone:!0,controller:new h.framework.html.SlideOutController});h.framework.html.layoutControllers.push({navigationType:"slideout",
platform:"generic",controller:new h.framework.html.SlideOutController})})(jQuery,DevExpress);(function(g,h,e){h.framework.html.EmptyLayoutController=h.framework.html.DefaultLayoutController.inherit({ctor:function(c){c=c||{};c.layoutTemplateName="empty";this.callBase(c)}});h.framework.html.layoutControllers.push({navigationType:"empty",controller:new h.framework.html.EmptyLayoutController})})(jQuery,DevExpress);
var EN_US=function(g){return{Language:"English",Common:{Default:"Default",Back:"Back",NoDataText:"No data to display"},Navigation:{Order:"New Order",OrderList:"Order List",RoadMapList:"Road Map",Clients:"Clients",ReadNews:"Read News",Preferences:"Preferences",Info:"Info"},Preferences:{Title:"Preferences",Main:"Main Preferences",Functions:"Functions",Admin:"Admin",Layout:"Layout Style",MapProvider:"Map Provider",Language:"Language UI",Incorrect_password:"Incorrect password"},Order:{Title:"Order",Note:"Note",
NotePrompt:"Comments, if any",ColDate:"Date",ColName:"Name",ColNote:"Note",ColOther:"Other",ColWars:"Wars"},Products:{ColName:"Name",ColPack:"Pack",ColCount:"Count",ColPrice:"Price"}}}(window),RU_RU=function(g){g={Language:"Русский",Common:{Yes:"Да",No:"Нет",Cancel:"Отменить",Default:"по умолчанию",Back:"назад",Save:"Сохранить",
Search:"Поиск",Select:"Выбор ...",Confirm:"Подтвердите",Loading:"Загружается ...",NoDataText:"Нет данных",EMailNotValid:"EMail не корректный",CurrentLocation:"Текущее положение",
SomethingWrong:"Что-то пошло не так",ServerOper:"Серверная Операция",ServerReply:"Ответ Сервера: ",EMail:"BAndySoft@gmail.com"},Navigation:{Order:"Новый Заказ",OrderList:"Заказы",RoadMapList:"Дорожные Карты",
Clients:"Клиенты",ReadNews:"Новости",Preferences:"Настройка",Info:"Инфо"},ReadNews:{LoadData:"Загрузка Данных",SaveOrd:"Отправить Заказы",LoadOst:"Обновить товарные остатки",
LoadSpr:"Обновить справочники и карты",RepoName:"Отчет",SelectRepo:"Выбери Отчет",SendRepo:"Отправить Отчет на EMail",ChoiceRepo:"Отчет не выбран",ReadRecs:"Прочитано записей",
WroteRecs:"Запись ",Title:"Обмен Новостями"},Preferences:{Main:"Основные свойства",Functions:"Пользователь",Admin:"Админ",Layout:"Стиль Интерфейса",MapProvider:"Поставщик Карт",
Language:"Язык интерфейса",TableMode:"Табличный выбор товаров",UseWebDb:"Использовать Web Db",DebugMode:"Режим отладки",UserName:"Имя Пользователя",
UserPassword:"Пароль на сервере",UserEMail:"EMail",Incorrect_password:"Не правильный пароль",Title:"Настройка"},Order:{Products:"Товары",Date:"Дата",Client:"Клиент",SelectClient:"Выбор клиента ",
Point:"Торговая точка",SelectPoint:"Выбор точки ",SelectDop:"Выбор типа параметра ",SelectParam:"Выбор параметра ",Note:"Примечания",NotePrompt:"комментарии если есть",
ActionDelete:"Удалить заказ",ChangeActivity:"Сменить активность",SwTitle1:"Заказы на сервере",SwTitle2:"Локальные заказы",ErrNoWars:"Не выбраны товары в заказе",
ErrNoDate:"Не установлена дата в заказе",ErrNoCli:"Не выбран клиент",Title:"Заказ"},Products:{Title2:"Корзина",btnSwText1:"корзина",btnSwText2:"товары",TitleCat:"Выбери категорию",
TitleDetails:"количество товара",ErrQuantity:"Введите число больше 0",FldQuantity:"Количество:",FldName:"Наименование:",FldPrice:"Цена:",FldOstat:"Остаток:",SelSum:"выбрано: #; на сумму: ",
Title1:"Выбор товаров"},Clients:{RoutDetail:"Маршрут подробно",Title:"Клиент"},RoadMap:{AddToTheMap:"Добавить клиента",ShowOnTheMap:"Показать на карте",OpenBil:"Открыть Заказ",
ActionDelete:"Удалить клиента",MoveDown:"Переместить вниз",MoveUp:"Переместить вверх",Title:"Дорожная Карта"}};g.Info={IProducts:"Список продуктов",
IProductDet:"Характеристики",IMap:"Карта",IClient:"Клиент",IContacts:"Наши Контакты",Home:'<h1>Справка по Домашнему экрану BAsket</h1> <p>BAsket - это программный комплекс для тогрового агента, который хочет формировать Заказы для Клиентов с использованием мобильных устройств (планшетов и коммуникаторов), то есть делать это быстро, эффективно и современно.</p> <p>Комплекс делится на локальнуя часть (BAsket, который Вы сейчас видите) и серверный модуль, отвечающий за передачу и хранение данных, а также за "общение" с учетной системой. Серверный модуль может быть настроен на учетную систему Вашего предприятия при помощи плагинов.</p> <p>BAsket может работать в двух основных режимах:</p> <ul> <li>Автономно - данные с сервера при чтении <a href="#Info/ReadNews">Новостей</a>, запоминаются в базе данных (Web Db) устройства, и в основном программа работает именно с локальными данными, </li> <li>Прямой доступ - все запросы поступают непосредственно на сервер и ответ сервера отображается сразу на Вашем экране</li> </ul> <p>Достоинства и недостатки этих двух режимов многочисленны, и мы приведем здесь только их часть.</p> <p>Автономный режим не требует постоянного доступа к Интернет, значительно "дешевле" по интернет трафику и скорость ответа системы уже полностью зависит от скорости работы Вашего мобильного устройства.</p> <p>Основное достоинство Прямого доступа - постоянно актуальные данные. Товарные остатки, а также списки Товаров и Клиентов на Вашем экране постоянно находятся в состоянии, максимально приближенном к Вашей учетной системе.</p> <p>Есть еще технические ограничения на использование Автономного режима. Устройства которые используют в качестве броузера Интернет Google Chrome (Android), Opera и Safari (iOs) смогут пользоваться Автономным режимом, остальным придется довольствоваться достоинствами Прямого доступа.</p> <p>Программой можно пользоваться и с обычного компьютера, но и в этом случае Автономный режим доступен только из Google Chrome.</p> <p>BAsket - это кроссплатформенное и кроссбраузерное приложение, написанное с использованием современной технологии Single-Page Application. Здесь использованы такие технологии как HTML5, CSS3, и JS-фреймворки PhoneJS, JQuery, Knockout. На самом деле - это сайт который может работать еще и как нативное приложение для мобильных устройств благодаря технологии PhoneGap.</p> <p>Естественно, что такое приложение на мобильном устройстве будет работать меленнее нативного. Но, во-первых производительность устройств растет очень быстро, а во-вторых возможность работать с одним продуктом на разных типах устройств сулит большую выгоду от использования.</p> <p>Хоть программа и анонсирована на поддержку коммуникаторов, мы все же советуем для реальной работы использовать планшеты. Размер экрана здесь имеет очень большое значение.</p> <p>Функционально BAsket содержит:</p> <ul> <li>Подготовку и корректироку <a href="#Info/Order">Заказов</a> для Клиентов</li> <li>Работа со <a href="#Info/OrderList">Списком Заказов</a></li> <li>Список <a href="#Info/RoadMapList">Дорожные карты</a> определяет маршрут движения торгового агента</li> <li>В <a href="#Info/Clients">Списке Клиентов</a> можно посмотреть маршрут от текущего положения до конкретной торговой точки</li> <li>В экране <a href="#Info/ReadNews">Новости</a> производится обмен информацией с сервером</li> <li><a href="#Info/Preferences">Настройка</a> системы кроме всего прочего позволит Вам "поиграться" со стилями интерфейса разных типов мобильных устройств</li> </ul> ',
Order:'<h1>Справка по экрану "Заказ"</h1> <p>Оформление и корректировка Заказа производится на трех, связанных переходами, экранах:</p> <ul> <li><a href="#Info/Order">Заказ</a></li> <li><a href="#Info/Products">Выбор товаров</a></li> <li><a href="#Info/Product-Details">Количество товара</a></li> </ul> <p>На этом экране нужно указать параметры "шапки" Заказа:</p> <ul> <li>Дата - дата предполагаемой отгрузки Заказа;</li> <li>Клиент - выбор Клиента, которому будет отгружен Заказ;</li> <li>Торговая Точка - выбор торговой точки Клиента, в которую будет отгружен Заказ. Если выбранный Клиент не имеет торговых Точек, это поле скрывается;</li> <li>* Предприятие - выбор юридического лица, на которого будет оформлен Заказ;</li> <li>* Тип Оплаты - выбор типа оплаты для Заказа;</li> <li>Примечания - любые примечания к Заказу;</li> <li>Информация о том, сколько выбрано товаров в Заказ и на какую сумму.</li> </ul> * параметры определяются конфигурацией программы и могут отсутствовать. <p>При нажатии на кнопку "Сохранить" производится проверка правильности оформления Заказа, и, если все сделано правильно, Заказ сохраняется в <a href="#Info/OrderList">Списке Заказов</a> и производится переход на экран, из которого пришли сюда. Это может быть <a href="#Info/Home">Домаший экран</a>, <a href="#Info/OrderList">Список Заказов</a> или <a href="#Info/RoadMap">Дорожные Карты</a></p> <p>Если проверка завершилась с ошибкой, внизу всплывает сообщение об ошибке. Список ошибочных ситуаций:</p> <ul> <li>Не выбраны товары в Заказе;</li> <li>Не установлена дата в Заказе;</li> <li>Не выбран клиент в Заказе;</li> </ul> <p>Кнопка "Сохранить" может отсутствовать, если Заказ корректируется в состоянии "Только для чтения".</p> <p>В титульной строке на экране слева направо находятся:</p> <ul> <li>Кнопка "назад" - переход к предыдущему экрану;</li> <li>Название экрана;</li> <li>Кнопка "I" - вызывает этот экран справки;</li> <li>Кнопка "Товары" - переход на экран <a href="#Info/Products">Выбор товаров</a>.</li> </ul> ',
Products:'<h1>Справка по экрану "Выбор товаров"</h1> <p>Выбор товаров - это второй из трех, связанных переходами, экранов для формирования Заказа:</p> <ul> <li><a href="#Info/Order">Заказ</a></li> <li><a href="#Info/Products">Выбор товаров</a></li> <li><a href="#Info/Product_Details">Количество товара</a></li> </ul> <p>Этот экран предназначен для выбора товаров в Заказ. Экран существует в двух режимах: "Выбор Товаров" и "Корзина".</p> <p>1) В режиме "Выбор Товаров" можно выбать товар в Заказ, нажав на элемент списка, сменить категорию Товаров и фильтровать Товары в рамках выбранной категории.</p> <p>В строке над списком Товаров слева, есть окно для поиска (фильтрации) списка Товаров, выбранной категории. Справа находится кнопка выбора карегории Товара. При ее нажатии всплывает список выбора категорий Товара. <p>В титульной строке слева направо находятся:</p> <ul> <li>Кнопка "назад" - переход к экрану <a href="#Info/Order">Заказ</a>;</li> <li>Название экрана;</li> <li>Кнопка "I" - вызывает этот экран справки;</li> <li>Кнопка "Корзина" - меняет режим экрана на "Корзина".</li> </ul> <p>2) В режиме "Корзина" можно просматривать и корректировать список выбранных в Заказ Товаров.</p> <p>Строка над списком Тораров содержит информацию о том, сколько выбрано товаров в Заказ и на какую сумму.</p> <p>В титульной строке слева направо находятся:</p> <ul> <li>Кнопка "назад" - переход к экрану <a href="#Info/Order">Заказ</a>;</li> <li>Название экрана;</li> <li>Кнопка "I" - вызывает этот экран справки;</li> <li>Кнопка "Товары" - меняет режим экрана на "Выбор товаров".</li> </ul> <p>В обоих режимах при нажатии на конкретный товар мы попадаем на следующий экран - <a href="#Info/Product-Details">Количество товара</a> для указания количества выбранного Товара в Заказ.</p> <p>Каждый элемент списка содержит:</p> <ul> <li>1-я строка - <b>[Количество в Заказе]</b> (отсутствует если Товар не выбран в Заказ)</li> <li>2-я строка - <b>[Наименование Товара]</b> </li> <li>3-я строка - <b>[Цена Товара]</b> ([Примечания]) </li> </ul> ',
Product_Details:'<h1>Справка по экрану "Количество товара"</h1> <p>Количество Товара - это третий из трех, связанных переходами, экранов для формирования Заказа:</p> <ul> <li><a href="#Info/Order">Заказ</a></li> <li><a href="#Info/Products">Выбор товаров</a></li> <li><a href="#Info/Product-Details">Количество товара</a></li> </ul> <p>Именно здесь формируется наполнение Корзины.</p> <p>На экране представлена полная характеристика выбранного Товара. Характеристики Товара - это:</p> <ul> <li>Количество - здесь можно изменить количество Товара в Заказе (если 0, то выбранный Товар удаляется из Корзины). Здесь же находится кнопка "Сохранить", при нажатии на которую устанавливается выбранное Количество и происходит возврат на экран <a href="#Info/Products">Выбор товаров</a>.</li> <li>Наименование</li> <li>Цена</li> <li>Остаток</li> <li>* Упаковка</li> <li>* Производитель</li> <li>* Артикул</li> <li>* Картинка Товара</li> </ul> * параметры определяются конфигурацией программы и могут отсутствовать. <p>В титульной строке на экране слева направо находятся:</p> <ul> <li>Кнопка "назад" - переход к экрану <a href="#Info/Products">Выбор товаров</a>;</li> <li>Название экрана;</li> <li>Кнопка "I" - вызывает этот экран справки;</li> </ul> ',
OrderList:'<h1>Справка по экрану "Список Заказов"</h1> <p>Здесь показывается Список Заказов в двух режимах:</p> <ul> <li>Локальные Заказы - это заказы сохраненные в локальной базе данных устройства, для просмотра этого списка не требуется подключение к сети Интернет</li> <li>Заказы на сервере - это список сохраненных на сервере Заказов. Для просмотра требуется подключение к Интернет.</li> </ul> <p>Переключение между режимами производится кнопкой в правом верхнем углу экрана с одноименным меняющимся текстом.</p> <p>В этой же строке слева есть поле для поиска (фильтрации списка) Заказов по имени Клиента.</p> <p>При нажатии на строку списка Заказов происходит переход на экран <a href="#Info/Order">Заказ</a>. При этом можно корректировать Заказ как в локальной базе данных, так и на сервере. Это зависит от выбранного режима.</p> <p>При длительном (примерно 0.5 секунды) нажатии на строку списка снизу выпадает контекстное меню со следующими пунктами: <ul> <li>Удалить Заказ - Заказ удаляется в зависимости от режима, локально или на сервере. Для выполнения действия требуется подтвердить операцию удаления;</li> <li>Сменить активность - Действие активно только в режиме "Локальные Заказы" и переключает признак необходимости отправки выбранного Заказа на сервер из экрана <a href="#ReadNews/">Новости</a>. Неактивные (уже отправленные на сервер) Заказы располагаются внизу списка и отмечаются серым фоном;</li> <li>Отменить - закрывает контекстное меню</li> </ul> <p>Каждый элемент списка содержит:</p> <ul> <li>1-я строка - [Номер Заказа] - [Дата сокращенно] <b>[Имя клиента] - [Имя точки (если есть)]</b> [Адрес Доставки]</li> <li>2-я строка - <b>[Сумма Заказа]</b> ([Примечания])</li> </ul> <p>В титульной строке на экране слева направо находятся:</p> <ul> <li>Кнопка "меню" - вызов бокового меню BAsket;</li> <li>Название экрана;</li> <li>Кнопка "I" - вызывает этот экран справки;</li> </ul> ',
Clients:'<h1>Справка по экрану "Список Клиентов"</h1> <p>Здесь показывается список Клиентов, на которых можно выписать Заказ</p> <p>Слева сверху имеется строка поиска (фильтрации списка)</p> <p>При нажатии на строку списка Клиентов происходит переход на экран <a href="#Info/Client">Клиент</a>. При этом можно посмотреть на карте местоположение Клиента и трассировку маршрута до адреса Клиента от текущего положения Вашего устройства.</p> <p>Каждый элемент списка содержит:</p> <ul> <li>1-я строка - <b>[Имя Клиента]</b></li> <li>2-я строка - [Адрес Клиента]</li> </ul> <p>В титульной строке на экране слева направо находятся:</p> <ul> <li>Кнопка "меню" - вызов бокового меню BAsket;</li> <li>Название экрана;</li> <li>Кнопка "I" - вызывает этот экран справки;</li> </ul> ',
Client:'<h1>Справка по экрану "Клиент"</h1> <p>Здесь на карте показывается текущая точка (Ваше положение) и точка адреса Клиента. Надо иметь ввиду, что если адрес Клиента в системе сохранен не правильно, то и точка на карте может быть отмечена в самом неожиданном месте :)</p> <p>Правильным адресом считается наличие следующей инфомации через запятую:</p> <ul> <li>1-я Дом и улица;</li> <li>2-я Город;</li> <li>3-я Страна (обычно можно опустить);</li> <li>4-я Почтовый индекс;</li> </ul> <p>В строке над картой указывается имя и адрес Клиента</p> <p>В титульной строке на экране слева направо находятся:</p> <ul> <li>Кнопка "назад" - возврат к экрану <a href="#Info/Clients">Список Клиентов</a>;</li> <li>Название экрана;</li> <li>Кнопка "I" - вызывает этот экран справки;</li> <li>Кнопка "=" - вызывает меню;</li> </ul> <p>Меню содержит пункты:</p> <ul> <li>Сохранить - ничего пока не делает :)</li> <li>Название экрана;</li> <li>Маршрут подробно - выводится окно с текстовой информацией от Google Map о расстоянии до точки Клиента, времени прохождения (на автомобиле) и подробно по пунктам предписания по передвижению до Клиента, аналогично информации с навигатора;</li> </ul> ',
RoadMapList:'<h1>Справка по экрану "Дорожные Карты" на дату</h1> <p>Здесь показывается список Клиентов, включенных в Дорожную карту на установленную дату. Этим самым показывается маршрут движения торгового агента по Клиентам в определенный день.</p> <p>В строке над списком Клиентов слева направо: <ul> <li>Дата - меняет список Дорожной карты на дату;</li> <li>Кнопка "Добавить клиента" - вызывает диалог для поиска и добавления нового клиента в Дорожную карту на дату;</li> <li>Кнопка "Показать на карте" - переход на экран <a href="#Info/RoadMap">Дорожная Карта</a></li> </ul> <p>При нажатии на строку списка Клиентов происходит переход на экран <a href="#Info/Client">Клиент</a> для просмотра Клиента на карте.</p> <p>При длительном (примерно 0.5 секунды) нажатии на строку списка снизу выпадает контекстное меню со следующими пунктами: <ul> <li>Открыть Заказ - переход на экран <a href="#Info/Order">Заказ</a>. Если Заказ для текущего Клиента еще не создан, он создается, иначе Заказ открывается в режиме корректировки;</li> <li>Переместить вверх - текущий Клиент перемещается вверх по списку, корректируя маршрут движения по Дорожной карте;</li> <li>Переместить вниз - текущий Клиент перемещается вниз по списку;</li> <li>Удалить Клиента - текущий Клиент удаляется из Дорожной катры;</li> <li>Отменить - закрывает контекстное меню</li> </ul> <p>Каждый элемент списка содержит:</p> <ul> <li>1-я строка - [Порядковый номер Клиента в маршруте] [Номер Заказа (если уже создан)] <b>[Имя Клиента - Точка]</b></li> <li>2-я строка - ([Адрес доставки]) </li> </ul> <p>В титульной строке на экране слева направо находятся:</p> <ul> <li>Кнопка "меню" - вызов бокового меню BAsket;</li> <li>Название экрана;</li> <li>Кнопка "I" - вызывает этот экран справки;</li> </ul> ',
RoadMap:'<h1>Справка по экрану "Дорожная Карта"</h1> <p>Здесь на карте показывается маршрут движения торгового агента по Клиентам в определенный день. Маркерами на карте обозначены адреса Клиентов, включенных в текущую Дорожную карту</p> <p>В титульной строке на экране слева направо находятся:</p> <ul> <li>Кнопка "назад" - возврат к экрану <a href="#Info/RoadMapList">Дорожные Карты на дату</a>;</li> <li>Название экрана;</li> <li>Кнопка "I" - вызывает этот экран справки;</li> </ul> ',
ReadNews:'<h1>Справка по экрану "Новости"</h1> <p>Здесь в режиме автономной работы можно отсылать сформированные Заказы на сервер и обновлять справочники.</p> <p>Если в экране <a href="#Info/Preferences">Настройка</a> выбрана работа без использования Web Db, будет показано сообщение "Нет данных".</p> <p>Иначе можно установить значение следующих переключателей:</p> <ul> <li>Отправить Заказы - если "ON", на сервер отправятся подготовленные Заказы, находящиеся в активном состоянии;</li> <li>Обновить товарные остатки - если "ON", с сервера прочитаются только остатки по Товарам;</li> <li>Обновить справочники и карты - если "ON", с сервера прочитаются все обновления по справочникам Товаров и Клиентов, а также новые (начиная с текущей даты и позднее) Дорожные карты;</li> </ul> При нажатии на кнопку "Загрузка Данных", начнется процесс обмена данными с сервером. <p>В титульной строке на экране слева направо находятся:</p> <ul> <li>Кнопка "меню" - вызов бокового меню BAsket;</li> <li>Название экрана;</li> <li>Кнопка "I" - вызывает этот экран справки;</li> </ul> ',
Preferences:'<h1>Справка по экрану "Настройка"</h1> <p>Здесь можно произвести некоторую настройку программы. Настройка имеет следующую структуру:</p> <ul> <li>Основные свойства:<br/><br/> <ul> <li>Стиль Интерфейса - вызывает список тем, которые можно использовать как основной стиль;</li> <li>Использовать Web Db - очень важный переключатель, определяющий будет использоваться автономный режим или нет;</li> <li>Табличный выбор товаров - переключатель режима работы на экране <a href="#Info/Products">Выбор товаров</a></li> </ul> </li> <li>Пользователь:<br/><br/> <ul> <li>Имя пользователя - имя, по которому сервер будет "узнавать" пользователя;</li> <li>Пароль на сервере - надо устанавливать если работа ведется не с мобильного устройства;</li> <li>EMail - адрес EMail пользователя (опцинально)</li> </ul> </li> <li>Админ - некоторые административные настройки программы, защищенные паролем </li> </ul> <p>В титульной строке на экране слева направо находятся:</p> <ul> <li>Кнопка "меню" - вызов бокового меню BAsket;</li> <li>Название экрана;</li> <li>Кнопка "I" - вызывает этот экран справки;</li> </ul> ',
Contacts:'<h1>Наши Контакты</h1> <p>BAndy Soft - это небольшая компания, производящая компьютерные программы для бизнеса.</p> <p>Мы будем рады, если Вы отправите Ваши отзывы по программе BAsket на EMail <a href="mailto: '+
g.Common.EMail+'">'+g.Common.EMail+"</a></p> ",SysInfo:'<h1 class="center">Системная информация</h1>CurrentDevice : '+(DevExpress.devices.current().generic?" =generic= ":"")+(DevExpress.devices.current().phone?" =phone= ":"")+(DevExpress.devices.current().tablet?" =tablet= ":"")+(DevExpress.devices.current().android?" =android= ":"")+(DevExpress.devices.current().ios?" =ios= ":"")+(DevExpress.devices.current().tizen?
" =tizen= ":"")+(DevExpress.devices.current().win8?" =win8= ":"")+"<br/>DeviceType  : "+DevExpress.devices.current().deviceType+"<br/>Platform  : "+DevExpress.devices.current().platform+"<br/><br/>Screen Size: "+screen.height+" x "+screen.width+"<br/>Agent: "+navigator.userAgent+"<br/>Cookie: "+(navigator.cookieEnabled?"Enabled":"Disabled"),Title:"Информация"};return g}(window),U=function(g,h){var e={},c=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,
f=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,b=/[^-+\dA-Z]/g,m=function(b,a){b=String(b);for(a=a||2;b.length<a;)b="0"+b;return b};return function(n,e,g){var l=c;1!=arguments.length||"[object String]"!=Object.prototype.toString.call(n)||/\d/.test(n)||(e=n,n=void 0);n=n?new Date(n):new Date;if(isNaN(n))throw SyntaxError("invalid date");e=String(l.masks[e]||e||l.masks["default"]);"UTC:"==e.slice(0,4)&&(e=e.slice(4),
g=!0);var d=g?"getUTC":"get",k=n[d+"Date"](),h=n[d+"Day"](),r=n[d+"Month"](),t=n[d+"FullYear"](),s=n[d+"Hours"](),x=n[d+"Minutes"](),y=n[d+"Seconds"](),d=n[d+"Milliseconds"](),w=g?0:n.getTimezoneOffset(),q={d:k,dd:m(k),ddd:l.i18n.dayNames[h],dddd:l.i18n.dayNames[h+7],m:r+1,mm:m(r+1),mmm:l.i18n.monthNames[r],mmmm:l.i18n.monthNames[r+12],yy:String(t).slice(2),yyyy:t,h:s%12||12,hh:m(s%12||12),H:s,HH:m(s),M:x,MM:m(x),s:y,ss:m(y),l:m(d,3),L:m(99<d?Math.round(d/10):d),t:12>s?"a":"p",tt:12>s?"am":"pm",T:12>
s?"A":"P",TT:12>s?"AM":"PM",Z:g?"UTC":(String(n).match(f)||[""]).pop().replace(b,""),o:(0<w?"-":"+")+m(100*Math.floor(Math.abs(w)/60)+Math.abs(w)%60,4),S:["th","st","nd","rd"][3<k%10?0:(10!=k%100-k%10)*k%10]};return e.replace(a,function(b){return b in q?q[b]:b.slice(1,b.length-1)})}}();c.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",
isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};c.i18n={dayNames:"Sun Mon Tue Wed Thu Fri Sat Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),monthNames:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec January February March April May June July August September October November December".split(" ")};e.DateFormat=function(a,f){f||(f="dd-mm-yyyy");return c(a,f)};return e}(jQuery,window),P=function(g,h){function e(b,a){var f=
h.localStorage.getItem(b);!f&&a&&(f=a,h.localStorage.setItem(b,f));return f}function c(b,a){for(var f in b)if(b.hasOwnProperty(f)&&f==a)return b[f]}var a={navigation:[{id:"Home",action:"#home",heightRatio:4,widthRatio:4,icon:"home",title:"BAsket",backcolor:"black"},{id:"Order",action:"#Order",heightRatio:4,widthRatio:8,icon:"cart",title:"NewOrder",backcolor:"#FF981D"},{id:"OrderList",action:"#OrderList",heightRatio:4,widthRatio:4,icon:"favorites",title:"Order List",backcolor:"#15992A"},{id:"RoadMapList",
action:"#RoadMapList",heightRatio:4,widthRatio:8,icon:"map",title:"RoadMap",backcolor:"#006AC1"},{id:"Clients",action:"#Clients",heightRatio:4,widthRatio:8,icon:"globe",title:"Clients",backcolor:"#7200AC"},{id:"ReadNews",action:"#ReadNews",heightRatio:4,widthRatio:4,icon:"download",title:"ReadNews",backcolor:"red"},{id:"Preferences",action:"#Preferences",heightRatio:4,widthRatio:4,icon:"preferences",title:"Preferences",backcolor:"red"},{id:"Info",action:"#Info",heightRatio:4,widthRatio:2,icon:"info",
title:"Info",backcolor:"#7200AC"}]};a.loadPanelVisible=ko.observable(!1);a.getLocalStor=function(b,a){var f=e(b,a);return"true"==f?!0:"false"==f?!1:f};a.ChangeLookup=function(b,a){var f=g(b).data("dxLookup").option("value");h.localStorage.setItem(a,f);return f};a.ChangeValue=function(b,a){h.localStorage.setItem(b,a);return a};var f={English:EN_US,"Русский":RU_RU};a.ChangeLanguageUI=function(){_="-"==a.languageUI?RU_RU:c(f,a.languageUI);a.navigation.forEach(function(a){var f=
eval("_.Navigation."+a.id);f&&(a.title=f)})};a.LoadFile=function(a,f){if("js"==f){var c=document.createElement("script");c.setAttribute("type","text/javascript");c.setAttribute("src",a)}else"css"==f&&(c=document.createElement("link"),c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",a));"undefined"!=typeof c&&document.getElementsByTagName("head")[0].appendChild(c)};a.geoCurrent=ko.observable("");a.getGeo=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){a.geoCurrent(b.coords.latitude.toFixed(6)+
","+b.coords.longitude.toFixed(6))},function(b){a.geoCurrent("string"==typeof b?b:"failed")})};a.getDistance=function(a,f){var c=(f[0]-a[0])*Math.PI/180,e=(f[1]-a[1])*Math.PI/180,g=a[0]*Math.PI/180,l=f[0]*Math.PI/180,c=Math.sin(c/2)*Math.sin(c/2)+Math.sin(e/2)*Math.sin(e/2)*Math.cos(g)*Math.cos(l);return 12742*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))};a.geoBearing=function(a,f){var c=(f[1]-a[1])*Math.PI/180,e=Math.sin(c)*Math.cos(f[0]),c=Math.cos(a[0])*Math.sin(f[0])-Math.sin(a[0])*Math.cos(f[0])*
Math.cos(c);return 180*Math.atan2(e,c)/Math.PI};a.geoCoder=function(a){var f=new google.maps.Geocoder,c=new g.Deferred;f.geocode({address:a},function(a,b){var f=[];b==google.maps.GeocoderStatus.OK&&(f=[a[0].geometry.location.lat().toFixed(6),a[0].geometry.location.lng().toFixed(6)]);c.resolve(f)});return c};a.itemClick=function(a){BAsket.app.navigate(a.itemData.action.substring(1),{direction:"none",root:!0})};a.itemIcon=function(a){return"tileicon dx-icon-"+a.toLowerCase()};a.itemCount={OrderList:e("OrderList",
"0"),RoadMapList:e("RoadMapList",""),Clients:e("Clients",""),ReadNews:e("ReadNews","")};a.setQuantToWar=function(a){for(var f in P.arrayBAsket)if(P.arrayBAsket[f].Id==a.Id){a.Quant=P.arrayBAsket[f].Quant;break}return a};a.validateEmail=function(a){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a)};a.getDeviceId=function(){var b="";h.device&&(b=h.device.uuid,a.bPhoneGap=!0);b||(b=
e("userPassword","-"));return b};a.deviceInfo=DevExpress.devices.current();a.layout="slideout";a.deviceClass="android";a.curCategoryId=0;a.curCategoryName="";a.curModeChoice=!0;a.modeProdView=!0;a.fromProducts=!1;a.arrayBAsket=[];a.arrayBAsketL=[];a.copyright="";a.debugMode=!1;a.useWebDb=!0;a.bPhoneGap=!1;a.maxSizeLocalDb=5E6;a.arrCategory=[];a.arrNMS=[];a.dataSouceUrl="";a.pageSize=30;a.Init=function(){a.useWebDb="true"==e("useWebDb","true");a.platformDevice="android";a.platformDevice=e("Platform",
"android");"-"==a.platformDevice&&(a.platformDevice=a.deviceInfo.platform);a.deviceClass={};a.deviceClass.platform=a.platformDevice;var b=a.platformDevice.split(" ");"generic"==b[0]&&a.LoadFile("css/dx.generic.light.css","css");1<b.length?(a.deviceClass.platform=b[0],"ios"==b[0]&&"v6"==b[1]?a.deviceClass.version="6":"black"==b[1]&&("android"==b[0]&&a.LoadFile("css/dx.android.holo-dark.css","css"),"tizen"==b[0]&&a.LoadFile("css/dx.tizen.black.css","css"))):"tizen"==b[0]&&a.LoadFile("css/dx.tizen.white.css",
"css");a.dataSouceUrl=e("dataSouceUrl","");a.adminPassword=e("adminPassword","admin");a.modeProdView="true"==e("modeProdView","true");a.debugMode="true"==e("debugMode","true");a.mapProvider=e("MapProvider","google");a.languageUI="-";a.languageUI=e("LanguageUI","-");a.ChangeLanguageUI();BAsket.navigation=P.navigation.slice(0);BAsket.navigation=BAsket.navigation.splice(1);a.UserName=e("userName","-");"-"==a.UserName&&(a.UserName="BAsket User");a.UserPassword=e("userPassword","-");"-"==a.UserPassword&&
(a.UserPassword=a.getDeviceId());a.UserEMail=e("userEMail","-");b="Basic "+[a.UserName,a.UserPassword].join(":");b=DevExpress.data.base64_encode(b);document.cookie=".BAsketAUTH="+b;sessionStorage[".BAsketAUTH"]=b;a.ajaxHeaders=a.bPhoneGap||!location.port?{Authorization:b}:{};a.copyright="BAsket © 2014 BAndy Soft. All rights reserved ("+a.deviceClass.platform+"; ver. "+BAsketVer+")";a.arrCategory=JSON.parse(e("categories","{}"));if(a.arrCategory.length){a.arrNMS[0]=JSON.parse(e("NMS0","{}"));
for(b=0;b<a.arrNMS[0].length;b++)a.arrNMS[a.arrNMS[0][b].Id]=JSON.parse(e("NMS"+a.arrNMS[0][b].Id,""));0<a.arrCategory.length&&(a.curCategoryId=a.arrCategory[0].Id,a.curCategoryName=a.arrCategory[0].N);DAL.TableCount();(b=g("#idMainTileView").data("dxTileView"))&&b.repaint()}else DAL.ReadNews(!0,!0)};return a}(jQuery,window);window.onerror=function(g,h,e,c,a){g="Error: "+g+"\nurl: "+h+"\nline #: "+e+"/"+c+"";alert(g);console.log(g);console.log(a.stack);return!0};eval('"use strict";');
window.BAsket={};$(function(){window.isphone=-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://");window.isphone?document.addEventListener("deviceready",onDeviceReady,!1):onDeviceReady()});
function onDeviceReady(){P.Init();DevExpress.devices.current(P.deviceClass);BAsket.app=new DevExpress.framework.html.HtmlApplication({namespace:BAsket,navigationType:P.layout,navigation:P.navigation,navigateToRootViewMode:!0,commandMapping:{"android-header-toolbar":{commands:[{id:"cmdInfo",align:"right"}]},"ios-header-toolbar":{commands:[{id:"cmdInfo",align:"right"}]},"tizen-header-toolbar":{commands:[{id:"cmdInfo",align:"right"}]},"generic-header-toolbar":{commands:[{id:"cmdInfo",align:"right"}]}}});
BAsket.app.router.register(":view/:Id",{view:"home",Id:void 0});BAsket.app.navigate()}BAsket.notify=function(g,h,e){h||(h="success");e||(e=1E3);DevExpress.ui.notify(g,h,e)};BAsket.error=function(g){BAsket.notify(g,"error",5E3)};
var _=EN_US,DAL_web=function(g,h){function e(a,b){return a.lookup?new DevExpress.data.DataSource({pageSize:P.pageSize,load:function(c){a.paging&&(a.prm.skip=c.skip,a.prm.take=c.take);c.searchValue&&(a.prm.searchString=c.searchValue);return g.ajax({url:P.dataSouceUrl+a.control,data:a.prm,xhrFields:{withCredentials:!0},headers:P.ajaxHeaders}).done(function(a){if(!a)return null;g.map(a,function(a){return b?b(a):a})})},lookup:function(a){return"lookup"}}):new DevExpress.data.DataSource({pageSize:P.pageSize,
load:function(b){a.paging&&(a.prm.skip=b.skip,a.prm.take=b.take);return g.ajax({type:"GET",url:P.dataSouceUrl+a.control,data:a.prm,xhrFields:{withCredentials:!0},headers:P.ajaxHeaders})},map:function(a){return b?b(a):a}})}function c(a,b){return new DevExpress.data.DataSource({pageSize:P.pageSize,load:function(c){return g.ajax({type:a.method,url:P.dataSouceUrl+a.control,data:a.prm,xhrFields:{withCredentials:!0},headers:P.ajaxHeaders,success:function(a){BAsket.notify(_.Common.ServerReply+a.Note)},error:function(a,
b){BAsket.error(a.statusText+": "+a.status)}}).done(function(a){if(!a)return null;g.map(a,function(a){return b?b(a):a})})}})}var a={};h.localStorage.getItem("dataSouceUrl")||h.DAL_tst||P.LoadFile("js/DAL_tst.js","js");a.NMS=function(a){return P.dataSouceUrl?e({control:"Nms"}):DAL_tst.NMS_Data};a.Categories=function(a){return P.dataSouceUrl?e({control:"Categories",lookup:!0}):DAL_tst.Categories_Data};a.Products=function(a){if(!P.dataSouceUrl)return DAL_tst.Products_Data;var b="Products";"ost"==a.pId&&
(b="ProdStock");return e({control:b,paging:!0,prm:{pId:a.pId,searchString:a.search}},function(a){var b=!1,f;for(f in P.arrayBAsket)P.arrayBAsket[f].Id==a.Id&&(a.Quant=P.arrayBAsket[f].Quant,b=!0);b||(a.Quant="");return a})};a.ProductDetails=function(a){e({control:"Products/"+a.Id}).load().done(function(b){b[0]=P.setQuantToWar(b[0]);a.model.Name(b[0].N);a.model.Price(b[0].P.toFixed(2));a.model.N1(b[0].N1);a.model.N2(b[0].N2);a.model.N3(b[0].N3);a.model.N4(b[0].N4);a.model.Ostat(b[0].O);a.model.Quant(b[0].Quant)})};
a.ProductsByWars=function(a){return e({control:"Products/",prm:{w:a}},function(a){return P.setQuantToWar(a)}).load()};a.Clients=function(a){if(!P.dataSouceUrl)return DAL_tst.Clients_Data;var b={control:"Clients",paging:!0,prm:{}};a?b.prm=a.search?{searchString:a.search}:a:b.lookup=!0;return e(b,function(a){a.Name=a.N;a.Adres=a.A;return a})};a.ClientsPar=function(a){return e({control:"Clients/"+a,prm:{fil:!0}},function(a){a.Name=a.N;a.Adres=a.A;return a})};a.ClientById=function(a){return e({control:"Clients/"+
a},function(a){a.Name=a.N;a.Adres=a.A;return a})};a.Bil=function(a){return e({control:"Bil",paging:!0,prm:{searchString:a.search}},function(a){a.Name=a.N1;a.Adres=a.N2;a.ShortDate=a.DateDoc.substring(0,5);return a})};a.BilById=function(a){return e({control:"Bil/"+a})};a.SaveBil=function(a){a.cmd="SaveBil";return c({method:"POST",control:"Bil/",prm:a}).load()};a.DeleteBil=function(a){a.cmd="DelBil";return c({method:"POST",control:"Bil/",prm:a}).load()};a.SendRepo=function(a){a.cmd="SendRepo";return c({method:"POST",
control:"Bil/",prm:a}).load()};a.RoadMap=function(a,b){prms={date:U.DateFormat(a,"yyyy-mm-dd")};b&&(prms.allGt=!0);return e({control:"RoadMap",paging:!0,prm:prms},function(a){a.Name=a.N1;a.Adres=a.N2;return a})};a.SaveRMBil=function(a,b){return c({method:"POST",control:"RoadMap/",prm:{cmd:"UpdIdB",Id:a,IdB:b}}).load()};return a}(jQuery,window);
function SQLite(g){function h(a){}function e(a){console||console.log("Oops. "+a.message+" (Code "+a.code+")")}function c(b,c,e,g){function h(a,c){k(c,b)}function l(a,c){e(a,c,b)}var d=c||[],k=g||a.defaultErrorHandler;b&&""!==b&&f.transaction(function(a){a.executeSql(b,d,l,h)})}if("undefined"!==typeof window.openDatabase){var a=g||{},f;a.shortName=a.shortName||"BAsketDB";a.version=a.version||"1.0";a.displayName=a.displayName||"BAsketDB SQLite Database";a.maxSize=P.maxSizeLocalDb;a.defaultErrorHandler=
a.defaultErrorHandler||e;a.defaultDataHandler=a.defaultDataHandler||h;f=openDatabase(a.shortName,a.version,a.displayName,a.maxSize);return{database:f,executeSql:function(a,e,f,g){c(a,e,f,g)},transaction:function(a,c,e){f.transaction(a,c,e)}}}}
var DAL=function(g,h){function e(a,b){return new DevExpress.data.DataSource({pageSize:a.paging?P.pageSize:P.maxSizeLocalDb,load:function(c){a.paging&&(a.skip=c.skip,a.take=c.take);a.searchValue=c.searchExpr&&c.searchValue?c.searchValue:null;var e=new g.Deferred;k=a.query;c="";a.searchString&&a.searchString()?c=a.searchString():a.searchValue&&(c=a.searchValue);if(c){var d=" and (N LIKE '%"+c+"%')";a.searchReg&&(d=a.searchReg.replace("@",c));k=0<k.indexOf("#")?k.replace("#",d):k+d}k=k.replace("#","");
a.paging&&(k+=" LIMIT "+a.skip+", "+a.take);v.executeSql(k,[],function(a,c){for(var q=[],d=0;d<c.rows.length;d++){var f=c.rows.item(d);b&&(f=b(f));q.push(f)}e.resolve(q)},function(a,b){p("*execDataSource sql*",a,b)});return e},lookup:function(a){return"lookup"}})}function c(a,b){var c=new g.Deferred;k=a;v.executeSql(k,[],function(a,q){if("INSERT "==k.toUpperCase().substring(0,7))c.resolve(q);else{for(var d=[],e=0;e<q.rows.length;e++){var f=q.rows.item(e);b&&(f=b(f));d.push(f)}c.resolve(d)}},function(a,
b){p("*execQuery sql*",a,b)});return c}function a(a,b,c,d,e){a.executeSql(b,c,function(a,b){for(var c=[],q=0;q<b.rows.length;++q)c.push(b.rows.item(q));d&&d(a,c,b,e)},function(a,b){p("*executeQuery*",a,b)})}function f(){for(var a in r)if(r[a])return!1;return!0}function b(a,b){if("NMS"==b){P.arrNMS=[];var c=0;for(c in a){var d=a[c].IdP;P.arrNMS[d]||(P.arrNMS[d]=[]);P.arrNMS[d].push(a[c]);P.ChangeValue("NMS"+d,JSON.stringify(P.arrNMS[d]))}r.NMS=!1;f()&&P.loadPanelVisible(!1)}"CAT"==b&&(a.length||(a=
[{Id:"0",Name:"-"}]),c=JSON.stringify(a),P.arrCategory=JSON.parse(P.ChangeValue("categories",c)),r.CAT=!1,f()&&P.loadPanelVisible(!1));"WAR"==b&&(s=a,v.transaction(function(a){k="Update WAR set O=0";a.executeSql(k,[],function(a,c){v.transaction(m,function(a,c){p("*write "+b+"*",a,c);P.loadPanelVisible(!1)},function(){l(_.ReadNews.WroteRecs+b+": success");r.WAR=!1;f()&&P.loadPanelVisible(!1)})},function(a,b){p("*writeToWAR-ost sql*",a,b)})}));"CLI"==b&&(x=a,v.transaction(n,function(a,c){p("*write "+
b+"*",a,c);P.loadPanelVisible(!1)},function(){l(_.ReadNews.WroteRecs+b+": success");r.CLI=!1;f()&&P.loadPanelVisible(!1)}));"MAP"==b&&(y=a,v.transaction(u,function(a,c){p("*write "+b+"*",a,c);P.loadPanelVisible(!1)},function(){l(_.ReadNews.WroteRecs+b+": success");r.MAP=!1;f()&&P.loadPanelVisible(!1)}))}function m(b){P.loadPanelVisible(!0);var c=s,d,e=c.length;for(d=0;d<e;d++)k="Select Id From WAR Where Id='"+c[d].Id+"'",a(b,k,[],function(a,b,c,d){"ost"==t&&c.rows.length?k="UPDATE WAR set O='"+d.O+
"' WHERE Id='"+d.Id+"'":(d.N1=d.N1?d.N1:"",d.N2=d.N2?d.N2:"",d.N3=d.N3?d.N3:"",d.N=d.N.replace(/'/g,"''"),d.N1=d.N1.replace(/'/g,"''"),d.N2=d.N2.replace(/'/g,"''"),d.N3=d.N3.replace(/'/g,"''"),d.N4=d.N4.replace(/'/g,"''"),k=c.rows.length?"UPDATE WAR set IdP='"+d.IdP+"', N='"+d.N+"', N1='"+d.N1+"', N2='"+d.N2+"', N3='"+d.N3+"', N4='"+d.N4+"', P='"+d.P+"', O='"+d.O+"' WHERE Id='"+d.Id+"'":"INSERT INTO WAR (Id, IdP, N, P, N1, N2, N3, N4, O) VALUES('"+d.Id+"','"+d.IdP+"','"+d.N+"','"+d.P+"','"+d.N1+"','"+
d.N2+"','"+d.N3+"','"+d.N4+"','"+d.O+"')");a.executeSql(k,[],function(a,b){},function(a,b){p("*writeToWAR sql*",a,b)})},c[d]);l(_.ReadNews.ReadRecs+" WAR: "+d)}function n(b){P.loadPanelVisible(!0);var c=x,d;for(d=0;d<c.length;d++)k="Select Id From CLI Where Id='"+c[d].Id+"'",a(b,k,[],function(a,b,c,d){d.IdP=null==d.IdP||"null"==d.IdP?"0":d.IdP;d.N=d.N.replace(/'/g,"''");d.A=d.A.replace(/'/g,"''");k=c.rows.length?"UPDATE CLI set IdP='"+d.IdP+"', N='"+d.N+"', A='"+d.A+"' WHERE Id='"+d.Id+"'":"INSERT INTO CLI (Id, IdP, N, A) VALUES('"+
d.Id+"','"+d.IdP+"','"+d.N+"','"+d.A+"')";a.executeSql(k,[],function(a,d){},function(a,d){p("*writeToCLI sql*",a,d)})},c[d]);l(_.ReadNews.ReadRecs+" CLI: "+d);P.itemCount.Clients=P.ChangeValue("Clients",d)}function u(a){P.loadPanelVisible(!0);var d=U.DateFormat(new Date,"yyyy-mm-dd");k="Delete From RMAP Where DateDoc>='"+d+"'";a.executeSql(k,[],function(a,b){var c=y,e;for(e=0;e<c.length;e++){var q=c[e];q.IdT=null==q.IdT||"null"==q.IdT?"0":q.IdT;d=U.DateFormat(q.D,"yyyy-mm-dd");k="INSERT INTO RMAP (DateDoc, Npp, IdC, IdT, Note) VALUES('"+
q.D+"','"+ +q.Npp+"','"+q.IdC+"','"+q.IdT+"','"+q.Note+"')";a.executeSql(k,[],function(a,d){},function(a,d){p("*writeToMAP sql*",a,d)})}l(_.ReadNews.ReadRecs+" MAP: "+e)},function(a,d){p("*writeToMAP-rd sql*",a,d)})}function p(a,d,b){l(a+" SQLError: "+(d?d.message?d.message:b.message:a)+"("+(d?d.code||d&&0==d.code?d.code:b.code:"")+") dbLastQ="+k);return!1}function l(a){if(P.debugMode){var d=document.getElementById("consoleOut");d&&(d.innerHTML+=a+"<br />")}console.log(a)}var d={},k="",v=SQLite(),
r={};d.Products=function(a,d){return P.useWebDb?e({query:"SELECT * FROM WAR WHERE IdP='"+a.pId+"' and O>0",paging:!d,searchString:a.search},function(a){var d=!1,b;for(b in P.arrayBAsket)P.arrayBAsket[b].Id==a.Id&&(a.Quant=P.arrayBAsket[b].Quant,d=!0);d||(a.Quant="");return a}):DAL_web.Products(a)};d.ProductDetails=function(a){if(!P.useWebDb)return DAL_web.ProductDetails(a);k="SELECT * FROM WAR WHERE Id='"+a.Id+"'";v.executeSql(k,[],function(d,b){a.Quant="0";a=P.setQuantToWar(a);0<b.rows.length&&(a.model.Name(b.rows.item(0).N),
a.model.Price(b.rows.item(0).P.toFixed(2)),a.model.N1(b.rows.item(0).N1),a.model.N2(b.rows.item(0).N2),a.model.N3(b.rows.item(0).N3),a.model.N4(b.rows.item(0).N4),a.model.Ostat(b.rows.item(0).O),a.model.Quant(a.Quant))})};d.ProductsByWars=function(a){var d="";P.arrayBAsket=[];var b=a.split(";"),e;for(e in b){var f=b[e].split(":");f[0]&&(P.arrayBAsket.push({Id:f[0],Quant:f[1]}),d+="'"+f[0]+"',")}return P.useWebDb?c("SELECT * FROM WAR WHERE Id in ("+d.substring(0,d.length-1)+")",function(a){return P.setQuantToWar(a)}):
DAL_web.ProductsByWars(a)};d.Clients=function(a){if(!P.useWebDb)return DAL_web.Clients(a);var d={query:"SELECT * FROM CLI Where IdP='0' or IdP=''",paging:!0};a&&a.search&&(d.searchString=a.search);return e(d)};d.ClientsPar=function(a){return P.useWebDb?e({query:"SELECT * FROM CLI Where IdP='"+a+"'"}):DAL_web.ClientsPar(a)};d.ClientById=function(a){return P.useWebDb?e({query:"SELECT c.*, par.N as ParName, IFNULL(par.N || ' - ' || c.N, c.N) as N2 FROM CLI c Left Join CLI par On c.IdP=par.Id Where c.Id='"+
a+"'"}):DAL_web.ClientById(a)};d.Bil=function(a,d){return!P.useWebDb||d?DAL_web.Bil(a):e({paging:!0,searchString:a.search,searchReg:" and (c.N LIKE '%@%')",query:"SELECT b.*, c.N as N1, t.N as N2, substr(b.DateDoc,1,5) as ShortDate, IFNULL(c.N || ' - ' || t.N, c.N) as Name, IFNULL(t.A, c.A) as Adres FROM Bil b Join CLI c On b.IdC=c.Id Left Join CLI t On b.IdT=t.Id Where 1=1 # Order by bSusp, Id desc"})};d.BilById=function(a,d){return!P.useWebDb||d?DAL_web.BilById(a):e({query:"SELECT b.*, c.N as N1, t.N as N2 FROM Bil b Join CLI c On b.IdC=c.Id Left Join CLI t On b.IdT=t.Id WHERE b.Id='"+
a+"'"})};d.SaveBil=function(a,d){if(!P.useWebDb||d)return DAL_web.SaveBil(a);var b="";a.sOther||(a.sOther="");a.sNote||(a.sNote="");a.sWars||(a.sWars="");a.sumDoc||(a.sumDoc="");b=a.id?"UPDATE Bil set DateDoc='"+a.date+"', IdC='"+a.IdC+"', IdT='"+a.IdT+"', SumDoc='"+a.sumDoc+"', Note='"+a.sNote+"', P1='"+a.sOther+"', Wars='"+a.sWars+"' WHERE Id='"+a.id+"'":"INSERT INTO Bil (DateDoc, IdC, IdT, SumDoc, Note, P1, Wars, bSusp) VALUES('"+a.date+"', '"+a.IdC+"','"+a.IdT+"','"+a.sumDoc+"','"+a.sNote+"', '"+
a.sOther+"', '"+a.sWars+"', 0)";return c(b)};d.ChangeActivityBil=function(a){return c("UPDATE Bil set bSusp = 1-bSusp WHERE Id="+a)};d.DeleteBil=function(a,d){return!P.useWebDb||d?DAL_web.DeleteBil(a):c("DELETE FROM Bil Where Id='"+a.id+"'")};d.SendBils=function(){P.useWebDb&&c("SELECT * FROM Bil WHERE bSusp=0").done(function(a){var d={},b;for(b in a)d.id=a[b].IdServ,d.IdLoc=a[b].Id,d.IdC=a[b].IdC,d.IdT=a[b].IdT,d.date=a[b].DateDoc,d.sNote=a[b].Note,d.sWars=a[b].Wars,d.sOther=a[b].Other,d.sumDoc=
a[b].SumDoc,DAL_web.SaveBil(d).done(function(a){var d="UPDATE Bil set bSusp=1";if(0<a[0].Note.length){var d=d+(", ServRet='"+a[0].Note+"'"),b=a[0].Note.split(" ")[0];0<b.length&&(d+=", IdServ='"+b+"'")}d+=" WHERE Id="+a[0].LocNum;c(d)})})};d.RoadMap=function(a){if(!P.useWebDb)return DAL_web.RoadMap(a);a=U.DateFormat(a,"yyyy-mm-dd");return e({query:"SELECT r.*, c.N as N1, t.N as N2, IFNULL(t.N || ' - ' || c.N, c.N) as Name, IFNULL(t.A, c.A) as Adres, IFNULL(t.Id, c.Id) as N3 FROM RMAP r Join CLI c On r.IdC=c.Id Left Join CLI t On r.IdT=t.Id Where DateDoc='"+
a+"' Order by Npp"})};d.SwapRmap=function(a,d,b,e,f){c("UPDATE RMAP set Npp="+d+" Where Id="+a).done(function(){c("UPDATE RMAP set Npp="+e+" Where Id="+b).done(function(){f()})})};d.DeleteRMap=function(a){return c("DELETE FROM RMAP Where Id='"+a+"'")};d.SaveRMBil=function(a,d){return P.useWebDb?c("UPDATE RMAP set IdB="+d+" Where Id="+a):DAL_web.SaveRMBil(a,d)};d.AddCliRMap=function(a,d){c("INSERT INTO RMAP (DateDoc, Npp, IdC, IdT) VALUES('"+a.date+"',"+a.Npp+",'"+a.IdC+"','"+a.IdT+"')").done(function(){d()})};
d.CountTable=function(a){return P.useWebDb?c("SELECT count(Id) as cnt FROM "+a):null};d.TableCount=function(a){if(!P.useWebDb)return null;DAL.CountTable("Bil").done(function(a){P.itemCount.OrderList=P.ChangeValue("OrderList",a[0].cnt)});DAL.CountTable("CLI").done(function(a){P.itemCount.Clients=P.ChangeValue("Clients",a[0].cnt)});DAL.CountTable("RMAP").done(function(a){var d=new Date,d=d.getDate()+"."+(d.getMonth()+1);P.itemCount.RoadMapList=P.ChangeValue("RoadMapList",d+" ("+a[0].cnt+")")})};var t;
d.ReadNews=function(a,c){P.loadPanelVisible(!0);r={NMS:!0,CAT:!0,WAR:!0,CLI:!0,MAP:!0};DAL_web.NMS().load().done(function(a){b(a,"NMS")});DAL_web.Categories().load().done(function(a){b(a,"CAT")});var e=new Date;P.itemCount.ReadNews=P.ChangeValue("ReadNews",e.getDate()+"."+(e.getMonth()+1));P.useWebDb?(c&&d.RecreateLocalDB(),t=a?"all":"ost",DAL_web.Products({pId:t}).load().done(function(a){b(a,"WAR")}),a?(DAL_web.Clients({pId:"all"}).load().done(function(a){b(a,"CLI")}),DAL_web.RoadMap(new Date,!0).load().done(function(a){b(a,
"MAP")})):(r.CLI=!1,f()&&P.loadPanelVisible(!1)),P.itemCount.OrderList=P.ChangeValue("OrderList",0),P.itemCount.RoadMapList=P.ChangeValue("RoadMapList",0),0<P.arrCategory.length?P.Init():BAsket.notify(_.Common.SomethingWrong,"error")):(r.WAR=r.CLI=!1,f()&&P.loadPanelVisible(!1))};d.RecreateLocalDB=function(){l("Local DB SCRIPT");v.transaction(function(a){for(i=0;i<w.length;i++)a.executeSql(w[i],[],function(a,d){},function(a,d){p("*RecreateLocalDB*",a,d)})})};var s,x,y,w="DROP TABLE IF EXISTS WAR;DROP TABLE IF EXISTS CLI;DROP TABLE IF EXISTS Bil;DROP TABLE IF EXISTS RMAP;DROP TABLE IF EXISTS BILM;CREATE TABLE IF NOT EXISTS WAR (Id unique, IdP, N, P DECIMAL(20,2), N1, N2, N3, N4, N5, O int, bSusp int);CREATE TABLE IF NOT EXISTS CLI (Id unique, IdP, N, A);CREATE TABLE IF NOT EXISTS Bil (Id INTEGER PRIMARY KEY AUTOINCREMENT, DateDoc DateTime, IdC, IdT, NumDoc, SumDoc, Note, Wars, P1, P2, DateSync DateTime, ServRet, IdServ, bSusp int);CREATE TABLE IF NOT EXISTS RMAP (Id INTEGER PRIMARY KEY AUTOINCREMENT, DateDoc DateTime, Npp int, IdB int, IdC, IdT, Note, DateSync DateTime, ServRet, bSusp int);".split(";");
return d}(jQuery,window);
BAsket.Order=function(g){var h=ko.observable([{Id:"",Name:""}]),e=ko.observable(!1),c=ko.observable(new Date),a=ko.observable(0),f=ko.observable(_.Order.SelectClient+"..."),b=ko.observable(0),m=ko.observable(_.Order.SelectPoint+"..."),n=ko.observable(""),u=ko.observableArray([_.Common.Select,_.Common.Select]),p=ko.observable("");P.fromProducts||(P.arrayBAsket=[]);g.Id&&DAL.BilById(g.Id,g.s).load().done(function(l){!P.fromProducts&&l[0].Wars&&DAL.ProductsByWars(l[0].Wars).done(function(a){P.arrayBAsket=a;
p(Order_calcSum())});var d=l[0].DateDoc;1<d.split(" ").length&&(d=d.split(" ")[0]);var k=d.split(".");1==k.length&&(k=d.split("-"));2<k[0].length?c(new Date(k[0],k[1]-1,k[2])):c(new Date(k[2],k[1]-1,k[0]));d=u();if(k=l[0].P1){for(var k=k.split(";"),g=0;g<k.length;g++){var r=k[g].split(":");if(!(2>r.length)){var t=parseInt(r[0]),s=$("#idNms"+t).data("dxSelectBox");if(s)for(s.option().value=r[1],s=0;s<P.arrNMS[t].length;s++)if(P.arrNMS[t][s].Id==r[1]){d[t-1]=P.arrNMS[t][s].N;break}}}u(d)}n(l[0].Note);
a(l[0].IdC);f(l[0].N1);b(l[0].IdT);m(l[0].N2?l[0].N2:_.Order.SelectPoint+"...");DAL.ClientsPar(l[0].IdC).load().done(function(a){h(a);e(0<a.length)})});Order_clientChanged=function(a){var d="";a&&0<a.element.length&&(d=$("#lookupClient").data("dxLookup").option().value);if(d){var b=this;b.tpId(0);b.tpName(_.Order.SelectPoint+"...");DAL.ClientsPar(d).load().done(function(a){b.arrayTP(a);b.showTP(0<a.length)})}};Order_calcSum=function(a){a=a?a.replace("-",""):_.Products.SelSum.replace("#",P.arrayBAsket.length);
var d=0,b;for(b in P.arrayBAsket)d+=P.arrayBAsket[b].Quant*P.arrayBAsket[b].P;return a+d.toFixed(2)};Order_btnSaveClicked=function(){if(0==P.arrayBAsket.length)BAsket.notify(_.Order.ErrNoWars,"error");else{var a=$("#idDate").data("dxDateBox").option("value");if(a){var d=$("#lookupClient").data("dxLookup").option("value");if(d){var b=$("#lookupTP").data("dxLookup").option("value"),c={};g.Id&&(c.id=g.Id);c.date=U.DateFormat(a);c.IdC=d;c.IdT=b?b:"";c.sumDoc=Order_calcSum("-");c.sOther="";for(a=0;a<P.arrNMS[0].length;a++)(d=
$("#idNms"+(a+1)).data("dxSelectBox"))&&d.option().value&&100>P.arrNMS[0][a].Id&&(c.sOther+=a+1+":"+d.option().value+";");c.sNote=$("#txtNote").data("dxTextArea").option("value");d="";for(a in P.arrayBAsket)d+=P.arrayBAsket[a].Id+":"+P.arrayBAsket[a].Quant+";";c.sWars=d.substring(0,d.length-1);DAL.SaveBil(c,g.s);Order_clickBack();(c=DAL.CountTable("Bil"))&&c.done(function(a){P.itemCount.OrderList=P.ChangeValue("OrderList",a[0].cnt)})}else BAsket.notify(_.Order.ErrNoCli,"error")}else BAsket.notify(_.Order.ErrNoDate,
"error")}};Order_clickBack=function(a){P.fromProducts=!1;g.Id?(a=BAsket.app.navigationManager.currentStack.currentIndex,1>a?BAsket.app.navigate("home",{root:!0}):(a=BAsket.app.navigationManager.currentStack.items[a-1].uri)&&"RoadMapList"==a?BAsket.app.navigate("RoadMapList",{root:!0}):BAsket.app.navigate("OrderList",{root:!0})):BAsket.app.navigate("home",{root:!0})};Order_clickProduct=function(){BAsket.app.navigate("Products/"+P.curCategoryId)};return{swValue:g.s,clients:DAL.Clients(),arrayTP:h,showTP:e,
calcSum:p,dataVal:c,cliId:a,cliName:f,tpId:b,tpName:m,noteVal:n,nmsNames:u,viewShown:function(){p(Order_calcSum());for(var a=0;a<P.arrNMS[0].length;a++){var d=$("#idNms"+(a+1));1==d.length&&10>P.arrNMS[0][a].Id&&(d.parent().show(),d[0].parentNode.children[0].innerText=P.arrNMS[0][a].N)}}}};
BAsket.OrderList=function(g){g=ko.observable(500);var h=ko.observable(!1),e=ko.observable(0),c=ko.observable(""),a=ko.observable(_.Order.SwTitle1),f=ko.observable(!1),b={dataSource:DAL.Bil({search:c}),dataSourceS:DAL.Bil({search:c},!0),popVisible:h,holdTimeout:g,popActions:[{text:_.Order.ActionDelete,clickAction:function(){Order_DeleteClick()}},{text:_.Order.ChangeActivity,disabled:f,clickAction:function(){Order_ChangeActivity()}}],searchString:c,swTitle:a,swValue:f,viewShown:function(){f()?b.dataSourceS.load():
b.dataSource.load()}};ko.computed(function(){return b.searchString()}).extend({throttle:500}).subscribe(function(){b.dataSource.pageIndex(0);b.dataSource.load();b.dataSourceS.pageIndex(0);b.dataSourceS.load()});Order_SwitchSource=function(){f(!f());f()?a(_.Order.SwTitle2):(a(_.Order.SwTitle1),b.dataSource.load())};Order_DeleteClick=function(){DevExpress.ui.dialog.custom({message:_.Order.ActionDelete+" "+e()+" ?",title:_.Common.Confirm,buttons:[{text:_.Common.Yes,clickAction:Order_Delete},{text:_.Common.Cancel}]}).show()};
Order_Delete=function(a){DAL.DeleteBil({id:e()},f());DAL.CountTable("Bil").done(function(a){P.itemCount.OrderList=P.ChangeValue("OrderList",a[0].cnt)});f()?b.dataSourceS.load():b.dataSource.load()};Order_ChangeActivity=function(){DAL.ChangeActivityBil(e()).done(function(a){b.dataSource.load()})};Order_processItemHold=function(a){e(a.itemData.Id);h(!0)};return b};
BAsket.Clients=function(g){P.getGeo();g=ko.observable("");var h=ko.observable(500),e=ko.observable(!1),c=ko.observable(0),a={searchString:g,popVisible:e,holdTimeout:h,popActions:[],dataSource:DAL.Clients({search:g})};ko.computed(function(){return a.searchString()}).extend({throttle:500}).subscribe(function(){a.dataSource.pageIndex(0);a.dataSource.load()});Client_processItemHold=function(a){c(a.itemData.Id);e(!0)};return a};
BAsket.Client=function(g){P.getGeo();var h=ko.observable("");ko.observable(P.geoCurrent());var e=ko.observable(!1),c=ko.observable(!1),a=ko.observable(""),f={visibleMenu:e,popupVisible:c,menuItems:[_.Common.Save,_.Clients.RoutDetail],cliName:h,options:{provider:P.mapProvider,mapType:"roadmap",width:"100%",height:"100%",zoom:15,readyAction:function(){Client_MapReadyAction()}}};Client_ClickMenu=function(a){e(!e())};Client_ClickMenuAction=function(b){e(!1);BAsket.notify(b.itemData);if(b.itemData==b.model.menuItems[0])Client_menuSaveGeo();
else if(b.itemData==b.model.menuItems[1]){var c=a();if(c.legs&&0!=c.legs.length){var f;f=""+("<p>Движение на авто "+c.legs[0].duration.text+"; расстояние "+c.legs[0].distance.text+"<br/>от: "+c.legs[0].start_address+"<br/>до: "+c.legs[0].end_address+"</p>");f+="<p>в основном по "+c.summary+"</p>";f+="<br/><p>По шагам:</p>";
for(var g in c.legs[0].steps)f+="<p>"+(parseInt(g)+1)+") "+c.legs[0].steps[g].duration.text+"; "+c.legs[0].steps[g].distance.text,f+="; "+c.legs[0].steps[g].instructions+"</p>";b.model.popupVisible(!0);$("#textContainer").html(f)}}};Client_menuSaveGeo=function(a){BAsket.notify("Client_menuSaveGeo")};Client_clickCancel=function(a){c(!1)};Client_PullDownActionFunction=function(a){a.component.release()};Client_MapReadyAction=function(b){P.loadPanelVisible(!1);var c=$("#idClientMap").data("dxMap");c.addMarker({tooltip:_.Common.CurrentLocation,
location:P.geoCurrent()});DAL.ClientById(g.Id).load().done(function(b){h(b[0].N2+" ("+b[0].A+")");var e=b[0].geoLoc;if(e=b[0].A)c.addMarker({tooltip:b[0].N+", "+b[0].A,location:e});else{P.geoCoder(b[0].Adres).done(function(a){c.addMarker({tooltip:b[0].N+", "+b[0].A,location:a})});var f=c._options.markers[0].location.split(","),g=c._options.markers[1].location.split(",");f&&g&&2==f.length&&2==g.length&&(e=P.getDistance(f,g),f=P.geoBearing(f,g),h(h()+" dist="+e+" dir="+f))}c.addRoute({weight:5,color:"blue",
locations:[c._options.markers[0].location,c._options.markers[1].location]});new google.maps.DirectionsRenderer;(new google.maps.DirectionsService).route({origin:c._options.markers[0].location,destination:c._options.markers[1].location,travelMode:google.maps.TravelMode.DRIVING},function(d,b){b==google.maps.DirectionsStatus.OK&&a(d.routes[0])})})};return f};
BAsket.RoadMapList=function(g){P.getGeo();var h=ko.observable(g.Id&&"undefined"!=g.Id?new Date(g.Id):new Date),e=ko.observable(0),c=ko.observable(!1);g=ko.observable(500);var a=ko.observable(!1),f=ko.observable(!1),b=ko.observable([{Id:"",Name:""}]),m=ko.observable(0),n=ko.observable(_.Order.SelectClient+"..."),u=ko.observable(0),p=ko.observable(_.Order.SelectPoint+"..."),l={dataVal:h,popupVisible:a,holdTimeout:g,popVisible:c,popActions:[{text:_.RoadMap.OpenBil,clickAction:function(){RoadMap_Action("OpenBil")}},
{text:_.RoadMap.MoveUp,clickAction:function(){RoadMap_Move("MoveUp")}},{text:_.RoadMap.MoveDown,clickAction:function(){RoadMap_Move("MoveDown")}},{text:_.RoadMap.ActionDelete,clickAction:function(){RoadMap_Action("DeleteClick")}}],dataSource:DAL.RoadMap(h()),clients:DAL.Clients(),arrayTP:b,showTP:f,cliId:m,cliName:n,tpId:u,tpName:p,viewShown:function(){var a=new Date;0>location.hash.indexOf("/")&&h().toLocaleDateString()!=a.toLocaleDateString()&&RoadMap_ChangeDate()}};RoadMap_ChangeDate=function(a){BAsket.app.navigate("RoadMapList/"+
h(),{direction:"none",root:!0})};RoadMap_AddToTheMap=function(d){a(!0)};RoadMap_clickCancel=function(d){a(!1)};RoadMap_clientChanged=function(a){var b="";a&&0<a.element.length&&(b=$("#lookupClient").data("dxLookup").option().value);if(b){var c=this;c.tpId(0);c.tpName(_.Order.SelectPoint+"...");DAL.ClientsPar(b).load().done(function(a){c.arrayTP(a);c.showTP(0<a.length)})}};RoadMap_ClientSave=function(d){if(d=$("#lookupClient").data("dxLookup").option("value")){var b=$("#lookupTP").data("dxLookup").option("value"),
c={};c.date=U.DateFormat(h(),"yyyy-mm-dd");c.IdC=d;c.IdT=b?b:0;c.Npp=0<l.dataSource.items().length?parseInt(l.dataSource.items()[l.dataSource.items().length-1].Npp)+1:1;DAL.AddCliRMap(c,RoadMap_Reload);a(!1);n(_.Order.SelectClient+"...");p(_.Order.SelectPoint+"...")}else BAsket.notify(_.Order.ErrNoCli,"error")};RoadMap_ClickShow=function(a){a=a.model.dataSource._items;P.arrayBAsket=[];P.arrayBAsketL=[];for(var b in a)a[b].Adres&&(P.arrayBAsket.push({tooltip:(a[b].N2?a[b].N1+" - "+a[b].N2:a[b].N1)+
" ("+a[b].Adres+")",location:a[b].Adres}),P.arrayBAsketL.push(a[b].Adres));BAsket.app.navigate("RoadMap/")};RoadMap_Move=function(a){var b=-1,c;for(c in l.dataSource._items)if(e().Id==l.dataSource._items[c].Id){b=parseInt(c);break}0>b||("MoveUp"==a&&0==b?(BAsket.notify("First Position Up"),navigator.notification.beep(1)):"MoveDown"==a&&b==l.dataSource._items.length-1?(BAsket.notify("Last Position Down"),navigator.notification.beep(1)):(a="MoveDown"==a?1:-1,DAL.SwapRmap(e().Id,l.dataSource._items[b+
a].Npp,l.dataSource._items[b+a].Id,e().Npp,RoadMap_Reload)))};RoadMap_Action=function(a){"DeleteClick"==a?DevExpress.ui.dialog.custom({message:_.RoadMap.ActionDelete+" "+e().Id+" ?",title:_.Common.Confirm,buttons:[{text:_.Common.Yes,clickAction:RoadMap_Delete},{text:_.Common.Cancel}]}).show():"OpenBil"==a?e().IdB?BAsket.app.navigate("Order/"+e().IdB):(a={},a.date=U.DateFormat(h()),a.IdC=e().IdC,a.IdT=e().IdT,a.Note=e().Note,DAL.SaveBil(a).done(function(a){var b=P.useWebDb?a.insertId:a[0].Id;DAL.SaveRMBil(e().Id,
b).done(function(){BAsket.app.navigate("Order/"+b);l.dataSource.load()})})):BAsket.notify(a)};RoadMap_Delete=function(a){DAL.DeleteRMap(e().Id);DAL.CountTable("RMAP").done(function(a){var b=new Date,b=b.getDate()+"."+(b.getMonth()+1);P.itemCount.RoadMap=P.ChangeValue("RoadMap",b+" ("+a[0].cnt+")")});l.dataSource.load()};RoadMap_processItemHold=function(a){e(a.itemData);c(!0)};RoadMap_Reload=function(a){l.dataSource.load()};return l};
BAsket.RoadMap=function(g){g={options:{provider:P.mapProvider,mapType:"roadmap",controls:!0,width:"100%",height:"100%",zoom:15,markers:P.arrayBAsket,routes:[{weight:5,color:"blue",locations:P.arrayBAsketL}],readyAction:function(){RoadMap_ReadyAction()}}};RoadMap_ReadyAction=function(g){P.loadPanelVisible(!1)};return g};
BAsket.Preferences=function(g){tabs=[{text:_.Preferences.Main,icon:"comment"},{text:_.Preferences.Functions,icon:"user"},{text:_.Preferences.Admin,icon:"preferences"}];var h=ko.observable(),e=ko.observable(0),c=ko.observable(!1);ko.computed(function(){2==e()?c(!0):c(!1);h(tabs[e()].content)});var a=ko.observable(P.dataSouceUrl),f=ko.observable("");ko.observable(!0);var b=ko.observable(P.modeProdView),m=ko.observable(P.debugMode),n=ko.observable(P.useWebDb),u=ko.observable(P.UserName);g=ko.observable(P.UserPass);
var p=ko.observable(P.UserEMail);Preferences_WsUrl=function(b){P.dataSouceUrl=P.ChangeValue("dataSouceUrl",a())};Preferences_TableMode=function(a){P.modeProdView=P.ChangeValue("modeProdView",b())};Preferences_useWebDb=function(a){P.useWebDb=P.ChangeValue("useWebDb",n())};Preferences_debugMode=function(a){P.debugMode=P.ChangeValue("debugMode",m())};Preferences_userName=function(a){P.UserName=P.ChangeValue("userName",u())};Preferences_userPass=function(a){P.UserPassword=P.ChangeValue("userPassword",
u())};Preferences_userEMail=function(a){P.validateEmail(p())?P.UserEMail=P.ChangeValue("userEMail",p()):BAsket.notify(_Common.EMailNotValid+": "+p())};Preferences_changePlatform=function(a){0<a.element.length&&(P.platformDevice=P.ChangeLookup("#lookupPlatform","Platform"),window.location.reload())};Preferences_changeMapProvider=function(a){0<a.element.length&&(P.mapProvider=P.ChangeLookup("#lookupMapProvider","MapProvider"))};Preferences_changeLanguageUI=function(a){0<a.element.length&&(P.languageUI=
P.ChangeLookup("#lookupLanguageUI","LanguageUI"),window.location.reload())};Preferences_clickLogin=function(){f()==P.adminPassword?c(!1):BAsket.notify(_.Preferences.Incorrect_password,"error")};Preferences_clickCancel=function(){c(!1)};Preferences_clickRecreateLocal=function(){DevExpress.ui.dialog.confirm("Вы уверены?","Пересоздание локальной базы данных").done(function(a){a&&
DAL.RecreateLocalDB()})};return{selectedTab:e,popupVisible:c,adminPassword:f,popupTitle:"Login",dataSouceUrl:a,dsMapProvider:{data:["google","googleStatic","bing"],value:ko.observable(P.mapProvider)},dsLanguage:{data:["-","English","Русский"],value:ko.observable(P.languageUI)},modeProdView:b,debugMode:m,useWebDb:n,userName:u,userPass:g,userEMail:p,dsPlatform:{data:"-;generic;ios;ios v6;android;android black;tizen;tizen black".split(";"),value:ko.observable(P.platformDevice)},
dsWsUrl:["","http://10.0.0.30/BWS2/api/","http://192.168.1.146/BAsketWS/api/"]}};
BAsket.Info=function(g){for(var h=ko.observable(""),e=ko.observable(""),c=[],a=0;a<P.navigation.length;a++){var f={},b;for(b in P.navigation[a])f[b]=P.navigation[a][b];c.push(f)}if(g.Id)h(g.Id),e(_.Info[g.Id]);else{c.splice(-1,1);c.push({id:"Products",heightRatio:4,widthRatio:8,icon:"cart",title:_.Info.IProducts,backcolor:"#FF981D"});c.push({id:"Product_Details",heightRatio:4,widthRatio:4,icon:"cart",title:_.Info.IProductDet,backcolor:"#FF981D"});c.push({id:"Client",heightRatio:4,widthRatio:4,icon:"globe",
title:_.Info.IClient,backcolor:"#7200AC"});c.push({id:"RoadMap",heightRatio:4,widthRatio:4,icon:"map",title:_.Info.IMap,backcolor:"#006AC1"});c.push({id:"Contacts",heightRatio:4,widthRatio:8,icon:"home",title:_.Info.IContacts,backcolor:"red"});c.push({id:"SysInfo",heightRatio:4,widthRatio:4,icon:"preferences",title:"SysInfo",backcolor:"black"});for(var m in c)c[m].action="#Info/"+c[m].id}return{dsInfo:c,title:_.Info.Title,subTitle:h,viewShown:function(){$("#textContainer").html(e())}}};
BAsket.ReadNews=function(g){g=[];for(var h in P.arrNMS[0])if(101==P.arrNMS[0][h].Id){g=P.arrNMS[parseInt(h)+1];break}var e=ko.observable(P.getLocalStor("modeSaveOrd",!0)),c=ko.observable(P.getLocalStor("modeLoadOst",!0)),a=ko.observable(P.getLocalStor("modeLoadSpr",!1));h={modeSaveOrd:e,modeLoadOst:c,modeLoadSpr:a,arrayRepo:g,viewShown:function(){$("#consoleOut").html()}};ReadNews_SUA=function(f){"modeSaveOrd"==f?P.ChangeValue(f,e()):"modeLoadOst"==f?P.ChangeValue(f,c()):"modeLoadSpr"==f&&P.ChangeValue(f,
a())};ReadNews_ReadNews=function(){e()&&DAL.SendBils();(c()||a())&&DAL.ReadNews(a())};ReadNews_SendRepo=function(){if(P.UserEMail&&P.validateEmail(P.UserEMail)){var a=$("#lookupRepo").data("dxLookup").option().value;a?DAL_web.SendRepo({id:a,mail:P.UserEMail}):BAsket.notify(_.ReadNews.ChoiceRepo)}else BAsket.notify(_Common.EMailNotValid)};return h};
BAsket.Products=function(g){P.fromProducts=!0;var h=ko.observable("");P.curCategoryId="undefined"==g.Id?P.curCategoryId:g.Id;(!P.curCategoryId||0==P.curCategoryId)&&0<P.arrCategory.length&&(P.curCategoryId=root.arrCategory[0].Id);var e=ko.observable(P.curModeChoice),c=ko.observable(_.Products.Title1),a=ko.observable(_.Products.btnSwText1),f=ko.observable(""),b={searchString:h,dataSourceCat:P.arrCategory,dataSourceBasket:new DevExpress.data.DataSource(new DevExpress.data.ArrayStore(P.arrayBAsket)),
dataSourceProd:DAL.Products({pId:P.curCategoryId,search:h},!P.modeProdView),bChoice:e,lbltitle:c,btnSwText:a,calcSum:f,viewShown:function(){b.dataSourceProd.load()}};ko.computed(function(){return b.searchString()}).extend({throttle:500}).subscribe(function(){b.dataSourceProd.pageIndex(0);b.dataSourceProd.load()});Products_calcSum=function(){var a=0,b;for(b in P.arrayBAsket)a+=P.arrayBAsket[b].Quant*P.arrayBAsket[b].P;return _.Products.SelSum.replace("#",P.arrayBAsket.length)+a.toFixed(2)};Products_swichClicked=
function(){P.curModeChoice=!P.curModeChoice;P.curModeChoice?(e(P.curModeChoice),c(_.Products.Title1),a(_.Products.btnSwText1)):(b.dataSourceBasket.load(),e(P.curModeChoice),c(_.Products.Title2),a(_.Products.btnSwText2),f(Products_calcSum()))};Products_categoryChanged=function(a){0>=a.element.length||(a=$("#CategoryLookup").data("dxLookup"),P.curCategoryId=a.option("value"),P.curCategoryName=$(".dx-state-active").html(),BAsket.app.navigate("Products/"+P.curCategoryId,{direction:"none"}))};Products_clickBack=
function(a){a=0;for(var b=BAsket.app.navigationManager.currentStack.items.length-1;0<b;b--)if(0==BAsket.app.navigationManager.currentStack.items[b-1].uri.indexOf("Order")){a=b;break}else BAsket.app.navigationManager.currentStack.items.splice(b-1,1);BAsket.app.navigationManager.currentStack.currentIndex=a;BAsket.app.back()};return b};
BAsket.Product_Details=function(g){var h={Id:g.Id,Name:ko.observable(""),Price:ko.observable(""),N1:ko.observable(""),N2:ko.observable(""),N3:ko.observable(""),N4:ko.observable(""),N1T:ko.observable(P.arrNMS[10][0]?P.arrNMS[10][0].N:""),N2T:ko.observable(P.arrNMS[10][1]?P.arrNMS[10][1].N:""),N3T:ko.observable(P.arrNMS[10][2]?P.arrNMS[10][2].N:""),N4T:ko.observable(P.arrNMS[10][3]?P.arrNMS[10][3].N:""),Ostat:ko.observable(""),Quant:ko.observable(),viewShown:function(){$("#idQuant").data("dxNumberBox").focus()}};
DAL.ProductDetails({Id:g.Id,model:h});Product_Details_saveClicked=function(e){e=!1;var c=parseInt(this.Quant()),a;for(a in P.arrayBAsket)if(P.arrayBAsket[a].Id==this.Id){c&&0<c?P.arrayBAsket[a].Quant=c:P.arrayBAsket.splice(a,1);e=!0;break}!e&&c&&0<c&&P.arrayBAsket.push({Id:this.Id,N:this.Name(),O:this.Ostat(),Quant:c,P:this.Price(),N1:this.N1(),N2:this.N2()});BAsket.app.back()};return h};
